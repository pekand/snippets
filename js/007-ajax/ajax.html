<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Ajax</title>
    
    <style>
    </style>
    
</head>
<body>
    
    <main>
    </main>

    <script type="text/javascript" >
        function response(xhr, success, error){
            if (xhr.status >= 200 && xhr.status < 300) {
                success(xhr);
            } else {
               error(xhr);
            }
        }
    </script>
    
    <script type="text/javascript" >
        
        function get(endpoint, data, success, error) {
            var xhr = new XMLHttpRequest();
            xhr.onload = function() {response(xhr, success, error)}
            
            var params = "";
            for(var key in data){
                 params += key+"="+encodeURIComponent(data[key])+"&";
            }
            params = params.slice(0, -1);
            
            xhr.open('get', endpoint+((params.length>0)?"?"+params:""));
            xhr.send();
        }
   
        get("json.php", {p1:1,p2:1}, function(xhr) {
            console.log(xhr);
            var response = JSON.parse(xhr.response);
            console.log(response);
        }, function(xhr) {
            console.log(xhr);
        });
    </script>
    
    <script type="text/javascript" >
        
        function post(endpoint, data, success, error) {
            var xhr = new XMLHttpRequest();
            xhr.onload = function() {response(xhr, success, error)}
            xhr.open('post', endpoint);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                       
            var params = "";
            for(var key in data){
                 params += key+"="+encodeURIComponent(data[key])+"&";
            }
            
            params = params.slice(0, -1);

            xhr.send(params);
        }
   
        post("json.php", {o:1,o2:2,o3:"custom data"}, function(xhr) {
            console.log(xhr);
            var response = JSON.parse(xhr.response);
            console.log(response);
        }, function(xhr) {
            console.log(xhr);
        });
    </script>
    
    <script type="text/javascript" >
        
        function json(endpoint, data, success, error) {
            var xhr = new XMLHttpRequest();
            xhr.onload = function() {response(xhr, success, error)}
            xhr.open('post', endpoint);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");    
            xhr.send(JSON.stringify(data));
        }
   
        json("json.php", {o:1,o2:2,o3:"custom data"}, function(xhr) {
            console.log(xhr);
            var response = JSON.parse(xhr.response);
            console.log(response);
        }, function(xhr) {
            console.log(xhr);
        });
    </script>
    
    <form id="form" action="post" enctype="multipart/form-data" onsubmit="return submitForm(this);">
        <input name="input1" type="text" value="test"><br>
        <textarea name="text1" cols="30" rows="10"></textarea><br>
        <input name="file1" type="file" /><br>
        <input type="submit">
    </form>
    
    <script type="text/javascript" >
        
        function form(form, endpoint, success, error) {
            var formData = new FormData(form);
            
            var xhr = new XMLHttpRequest();
            xhr.onload = function() {response(xhr, success, error)}
            xhr.open('post', endpoint, true);   
            xhr.send(formData);
        }
   
    function submitForm(el) {
        form(el, "json.php", function(xhr) {
            console.log(xhr);
            var response = JSON.parse(xhr.response);
            console.log(response);
        }, function(xhr) {
            console.log(xhr);
        });
        
        return false;
    }
    </script>
</body>
</html>

