<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>WebSocket Client</title>
    
    <style>
    </style>
    
</head>
<body>
    
    <main>
    </main>

    <script type="text/javascript" >
        var waitTime = 1000;
        var conn;
        function startWebsocket() {
            conn = new WebSocket('ws://127.0.0.1:8080');
            
            conn.onopen = function(e) {
                console.log("Connection established!");
                conn.send("Message to send");
                waitTime = 1000;
            };

            conn.onmessage = function(e) {
                console.log("Mesage from server:"+e.data);
                
                if(e.data == "PING"){
                    conn.send('PONG');
                }
            };
            
            conn.onopen = function() {
                console.log("Connection is open...");  
            };

            conn.onclose = function() { 
                console.log("Connection is closed..."); 
            };
           
            conn.onerror = function(error) {
                console.log(`Error: ${error.message}`);
            };
            
            window.addEventListener("beforeunload", function (e) {
                if (conn.readyState !== WebSocket.CLOSED) {
                   conn.close("1", "Fuck off!!");
                }
            });
        }

        startWebsocket();
        
        setInterval(function(){
            if (conn.readyState === WebSocket.CLOSED) {
               startWebsocket();
            }
        }, 1000);
    </script>
    
</body>
</html>

